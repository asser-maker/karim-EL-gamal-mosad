<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; }
        .container { width: 50%; margin: auto; }
        input, button { margin: 5px; padding: 10px; }
        .customer-list div { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 5px; border: 1px solid #ccc; margin-top: 5px; }
        .customer-list div:hover { background-color: #f0f0f0; }
        .delete-btn { background: none; border: none; cursor: pointer; color: red; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h2>
        <input type="text" id="customerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
        <button onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ©</button>
        <input type="text" id="searchBox" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„" oninput="searchCustomer()">
        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
        <div class="customer-list" id="customerList"></div>
        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
        <div id="customerDetails"></div>
        <button onclick="closeDetails()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <script>
        let customers = JSON.parse(localStorage.getItem('customers')) || [];

        function addCustomer() {
            let name = document.getElementById('customerName').value;
            if (name) {
                let newCustomer = {
                    name,
                    address: "",
                    phone: "",
                    device: "",
                    purchaseDate: "",
                    candles: Array(7).fill(Array(20).fill("")),
                    notes: "",
                    price: ""
                };
                customers.push(newCustomer);
                localStorage.setItem('customers', JSON.stringify(customers));
                displayCustomers();
                document.getElementById('customerName').value = "";
            }
        }

        function displayCustomers(filteredCustomers = customers) {
            let customerList = document.getElementById('customerList');
            customerList.innerHTML = "";
            filteredCustomers.forEach((customer, index) => {
                let div = document.createElement('div');
                div.innerHTML = `${customer.name} <button class="delete-btn" onclick="deleteCustomer(${index})">ğŸ—‘ï¸</button>`;
                div.onclick = () => showDetails(index);
                customerList.appendChild(div);
            });
        }

        function deleteCustomer(index) {
            customers.splice(index, 1);
            localStorage.setItem('customers', JSON.stringify(customers));
            displayCustomers();
        }

        function showDetails(index) {
            let customer = customers[index];
            let candleInputs = "";
            customer.candles.forEach((candle, candleIndex) => {
                candleInputs += `<p><strong>Ø´Ù…Ø¹Ø© ${candleIndex + 1}:</strong>`;
                candle.forEach((value, valueIndex) => {
                    candleInputs += `<input type="text" id="candle${candleIndex}_${valueIndex}" value="${value}">`;
                });
                candleInputs += "</p>";
            });

            document.getElementById('customerDetails').innerHTML = `
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${customer.name}</p>
                <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> <input type="text" id="customerAddress" value="${customer.address}"></p>
                <p><strong>Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†:</strong> <input type="text" id="customerPhone" value="${customer.phone}"></p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> <input type="text" id="customerDevice" value="${customer.device}"></p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡:</strong> <input type="text" id="purchaseDate" value="${customer.purchaseDate}"></p>
                ${candleInputs}
                <p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> <input type="text" id="notes" value="${customer.notes}"></p>
                <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> <input type="text" id="price" value="${customer.price}"></p>
                <button onclick="saveDetails(${index})">Ø­ÙØ¸</button>
            `;
        }

        function saveDetails(index) {
            customers[index].address = document.getElementById('customerAddress').value;
            customers[index].phone = document.getElementById('customerPhone').value;
            customers[index].device = document.getElementById('customerDevice').value;
            customers[index].purchaseDate = document.getElementById('purchaseDate').value;
            customers[index].notes = document.getElementById('notes').value;
            customers[index].price = document.getElementById('price').value;
            
            customers[index].candles.forEach((_, candleIndex) => {
                customers[index].candles[candleIndex] = Array.from({ length: 20 }, (_, valueIndex) => 
                    document.getElementById(`candle${candleIndex}_${valueIndex}`).value
                );
            });
            
            localStorage.setItem('customers', JSON.stringify(customers));
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
        }

        function closeDetails() {
            document.getElementById('customerDetails').innerHTML = "";
        }

        function searchCustomer() {
            let query = document.getElementById('searchBox').value.toLowerCase();
            let filtered = customers.filter(customer => customer.name.toLowerCase().includes(query));
            displayCustomers(filtered);
        }

        displayCustomers();
    </script>
</body>
</html>